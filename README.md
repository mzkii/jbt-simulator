## jbt-simulator
**jubeat-memo 形式** の譜面を mac/windows 上で再生するシミュレータです．


## [WIP] 機能👷
基本的に，jubeatLab に準拠する．
- 譜面再生
  - 任意倍速，シーク
- 譜面作成


## [WIP] jubeat-memo 形式から譜面を再生するアルゴリズム
```
2

口口口① |①ーーー|

口④口口 |ーーーー|

口口③口 |ーー②ー|

口②口口 |③ー④ー|
```

- **|** から **|** までを **1拍** と呼ぶ

- 1拍が **4つ分** で **1小節** になる <-- ここ重要
  - あくまでも4拍で1小節なので，小節の手前にある小節数(2とか16とか)は構文解析には関係ない．
  - 単に編集時に見やすくするために付け加えているだけ．
  - 以下の例では，この小節を構成する条件を利用して，4行で位置情報を定義できない場合に，分割して表現している．
    - ⑭は③と位置が重なっているため，16小節目を2小節分に分けて表現している．**しかし，生成される小節データは①小節分である．**

```
16
口⑧口① |①②③④|
⑥⑨②⑩ |⑤⑥⑦⑧|
⑫③⑪④ |⑨⑩⑪⑫|
⑬⑤口⑦ |⑬ー⑭ー|

口口口口
口口口口
口⑭口口
口口口口
```

 
## 譜面を構成する型
### Note型
- 譜面を構成する最小単位
- Note(note: String, t: Double, position: Int, bpm: Double)
- note; その小節におけるノーツを特定するための Key (①, ②, ...)
- bpm; そのノーツが出現する際のBPM
- t; そのノーツが，現在の小節内において，ノーツをタップすべき時間

```
2
t=60
口口口① |①ーーー|

口④口口 |ーーーー|

口口③口 |ーー②ー|

口②口口 |③ー④ー|
```

  - 上記2小節目の①ノーツの例
```
bpm が 60 なので，1分間に 60 拍存在することになる．

すなわち一拍あたり 1000ms， 1ノーツあたり 250ms，

すなわち①ノーツは Note(①, 250, 4, 60) と求まる．
```
- position; そのノーツが表示すべきパネル番号(1~16)
```
パネル番号対応表;

01  02  03  04
05  06  07  08
09  10  11  12
13  14  15  16
```

### Measure型
- Note型 の集合体
- Measure(measure: Int, notes: List < Note >)
- measure; 何小節目か
- notes; measure 小節目に出現する Note 型の配列

### Chart型
- Measure型 の集合体
- 譜面の全体を構成する
- Chart(difficulty: Difficulty, level: Int, measures: List < Measure >)
- difficulty; 難易度(BASIC or ADVANCED or EXTREME)
- level; レベル(lv1 ~ lv10)
- measures; 小節の配列

### Music型
- 楽曲情報を保持
- 楽曲データに対して1対1に対応する
- Music(title: String, artist: String, charts: List < Chart >)
- title; 楽曲名
- artist; アーティスト名
- charts; 楽曲データ1曲分に対応する譜面データ(基本的には3難易度分存在する)

```
>> music.print()
Music(hogehoge, fugafuga, 
Chart(Difficulty.BASIC, 3, 
Measure(1, 
Note(①, 250.0000, 01, 160.0000)
Note(②, 500.0000, 02, 160.0000)
Note(③, 750.0000, 03, 160.0000)
)
Measure(2, 
Note(①, 250.0000, 01, 160.0000)
Note(②, 500.0000, 02, 160.0000)
Note(③, 750.0000, 03, 160.0000)
)
Measure(3, 
Note(①, 250.0000, 01, 160.0000)
Note(②, 500.0000, 02, 160.0000)
Note(③, 750.0000, 03, 160.0000)
)
)
--------------------------------
Chart(Difficulty.ADVANCED, 7, 
Measure(1, 
Note(①, 250.0000, 01, 160.0000)
Note(②, 500.0000, 02, 160.0000)
Note(③, 750.0000, 03, 160.0000)
)
Measure(2, 
Note(①, 250.0000, 01, 160.0000)
Note(②, 500.0000, 02, 160.0000)
Note(③, 750.0000, 03, 160.0000)
)
Measure(3, 
Note(①, 250.0000, 01, 160.0000)
Note(②, 500.0000, 02, 160.0000)
Note(③, 750.0000, 03, 160.0000)
)
)
--------------------------------
Chart(Difficulty.EXTREME, 9, 
Measure(1, 
Note(①, 250.0000, 01, 160.0000)
Note(②, 500.0000, 02, 160.0000)
Note(③, 750.0000, 03, 160.0000)
)
Measure(2, 
Note(①, 250.0000, 01, 160.0000)
Note(②, 500.0000, 02, 160.0000)
Note(③, 750.0000, 03, 160.0000)
)
Measure(3, 
Note(①, 250.0000, 01, 160.0000)
Note(②, 500.0000, 02, 160.0000)
Note(③, 750.0000, 03, 160.0000)
)
)
--------------------------------
)

Process finished with exit code 0
```
## 解析アルゴリズム
- とりあえず，譜面ファイルを一行づつ読んでいく
- 以下の例の2小節目のデータを読んでいくことを考える
- ちなみに，ノーツデータが生成されるタイミングは2つある
```
2
t=60
口口口① |①ーーー|

口④口口 |ーーーー|

口口③口 |ーー②ー|

口②口口 |③ー④ー|
```
- 上の④では，**盤面データからノーツデータを生成** することになる．④が最初に出現した段階では，表示位置は6番パネルという情報は把握できるが，表示時間は未確定の状態である．すなわち Note(④, None, 6, 60) となる．Noneは未確定という意味．

- 上の②では，**時間データからノーツデータを生成** することになる．②が最初に出現した段階では，表示時間は **11x250=2750ms** という情報は把握できるが，表示位置は未確定の状態である．すなわち Note(②, 2750, None 60) となる．Noneは未確定という意味．

// TODO
